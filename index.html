<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PipocaFlix â€” Filmes e SÃ©ries Online</title>
<meta name="description" content="Assista filmes e sÃ©ries online grÃ¡tis no PipocaFlix. CatÃ¡logo completo, HD, sem travamentos.">
<meta name="theme-color" content="#e50914">
<link rel="stylesheet" href="../assets/css/style.css">

<!-- Social Bar MonetizaÃ§Ã£o -->
<script src="https://pl28456424.effectivegatecpm.com/af/b2/ae/afb2aeef36a1a40f4d3634823ebf0f59.js"></script>
</head>
<body>

<!-- ================================================
     MOBILE SEARCH OVERLAY
================================================ -->
<div class="mobile-search-overlay" id="mobileSearchOverlay" role="dialog" aria-label="Busca">
  <svg style="flex-shrink:0;color:var(--red)" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
    <circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/>
  </svg>
  <input type="search" class="mobile-search-input" id="mobileSearchInput"
    placeholder="Buscar filmes, sÃ©ries..." autocomplete="off" autocorrect="off" spellcheck="false">
  <button class="mobile-search-close" id="mobileSearchClose" aria-label="Fechar busca">Cancelar</button>
</div>

<!-- ================================================
     HEADER
================================================ -->
<header class="header" id="mainHeader">
  <a href="index.html" class="logo">PIPOCA<span>FLIX</span></a>

  <nav class="nav" aria-label="NavegaÃ§Ã£o principal">
    <a href="index.html" class="active">InÃ­cio</a>
    <a href="#filmes">Filmes</a>
    <a href="#series">SÃ©ries</a>
  </nav>

  <div class="search-wrapper" id="desktopSearchWrapper">
    <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/>
    </svg>
    <input type="search" class="search-bar" id="desktopSearchInput"
      placeholder="Buscar filmes e sÃ©ries..." autocomplete="off" autocorrect="off" spellcheck="false"
      aria-label="Buscar conteÃºdo">
  </div>

  <button class="search-toggle-btn" id="mobileSearchToggle" aria-label="Abrir busca" aria-expanded="false">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
      <circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/>
    </svg>
  </button>
</header>

<!-- ================================================
     SEARCH RESULTS OVERLAY
================================================ -->
<div class="search-results-overlay" id="searchResultsOverlay" role="region" aria-label="Resultados da busca">
  <p class="search-results-title">Resultados para: <span id="searchQueryLabel"></span></p>
  <div class="cards-grid" id="searchResultsGrid"></div>
  <p id="noResults" style="display:none;color:var(--text-muted);text-align:center;padding:2rem 0">
    Nenhum resultado encontrado. Tente outra busca.
  </p>
</div>

<!-- ================================================
     HERO
================================================ -->
<section class="hero" id="hero" aria-label="Destaque">
  <div class="hero-bg" id="heroBg"></div>
  <div class="hero-content" id="heroContent">
    <div class="hero-badge">ğŸ”¥ Em Destaque</div>
    <h1 class="hero-title" id="heroTitle">Carregando...</h1>
    <div class="hero-meta" id="heroMeta"></div>
    <p class="hero-synopsis" id="heroSynopsis"></p>
    <div class="hero-buttons">
      <a id="heroWatchBtn" href="#" class="btn-primary">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>
        Assistir Agora
      </a>
      <button class="btn-secondary" id="heroInfoBtn">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg>
        Mais InformaÃ§Ãµes
      </button>
    </div>
  </div>
</section>

<!-- ================================================
     MAIN CONTENT
================================================ -->
<main class="main-content" role="main">

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SEÃ‡ÃƒO: MAIS RECENTES
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <section class="section" id="recentes">
    <div class="section-header">
      <h2 class="section-title">ğŸ• Mais Recentes</h2>
      <span id="recentesCount" style="color:var(--text-muted);font-size:0.82rem"></span>
    </div>

    <!-- Skeleton -->
    <div class="skeleton-row" id="recentesSkeleton">
      <div class="skeleton"></div><div class="skeleton"></div>
      <div class="skeleton"></div><div class="skeleton"></div>
      <div class="skeleton"></div><div class="skeleton"></div>
      <div class="skeleton"></div><div class="skeleton"></div>
    </div>

    <!-- Grid -->
    <div class="cards-grid" id="recentesGrid" style="display:none"></div>

    <!-- Carregar mais -->
    <button class="load-more-btn hidden" id="recentesLoadMore">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"/></svg>
      Carregar mais
    </button>
  </section>

  <div class="section-divider"></div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SEÃ‡ÃƒO: FILMES
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <section class="section" id="filmes">
    <div class="section-header">
      <h2 class="section-title">ğŸ¬ Filmes</h2>
      <button class="section-link" id="filmesVerTudo" aria-expanded="false">
        Ver catÃ¡logo completo
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
          <path d="M9 18l6-6-6-6"/>
        </svg>
      </button>
    </div>

    <!-- Skeleton -->
    <div class="skeleton-row" id="filmesSkeleton">
      <div class="skeleton"></div><div class="skeleton"></div>
      <div class="skeleton"></div><div class="skeleton"></div>
      <div class="skeleton"></div><div class="skeleton"></div>
    </div>

    <!-- Preview: 15 aleatÃ³rios -->
    <div class="cards-grid" id="filmesPreviewGrid" style="display:none"></div>

    <!-- CatÃ¡logo completo (expandÃ­vel) -->
    <div class="catalogo-full" id="filmesCatalogo">
      <div class="section-header" style="margin-top:1.5rem">
        <span id="filmesCount" style="color:var(--text-muted);font-size:0.82rem"></span>
      </div>
      <div class="cards-grid" id="filmesFullGrid"></div>
      <nav class="pagination" id="filmesPagination" aria-label="PaginaÃ§Ã£o de filmes"></nav>
    </div>
  </section>

  <div class="section-divider"></div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SEÃ‡ÃƒO: SÃ‰RIES
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <section class="section" id="series">
    <div class="section-header">
      <h2 class="section-title">ğŸ“º SÃ©ries</h2>
      <button class="section-link" id="seriesVerTudo" aria-expanded="false">
        Ver catÃ¡logo completo
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
          <path d="M9 18l6-6-6-6"/>
        </svg>
      </button>
    </div>

    <!-- Skeleton -->
    <div class="skeleton-row" id="seriesSkeleton">
      <div class="skeleton"></div><div class="skeleton"></div>
      <div class="skeleton"></div><div class="skeleton"></div>
      <div class="skeleton"></div><div class="skeleton"></div>
    </div>

    <!-- Preview: 15 aleatÃ³rios -->
    <div class="cards-grid" id="seriesPreviewGrid" style="display:none"></div>

    <!-- CatÃ¡logo completo (expandÃ­vel) -->
    <div class="catalogo-full" id="seriesCatalogo">
      <div class="section-header" style="margin-top:1.5rem">
        <span id="seriesCount" style="color:var(--text-muted);font-size:0.82rem"></span>
      </div>
      <div class="cards-grid" id="seriesFullGrid"></div>
      <nav class="pagination" id="seriesPagination" aria-label="PaginaÃ§Ã£o de sÃ©ries"></nav>
    </div>
  </section>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       AD NATIVE â€” apÃ³s todas as seÃ§Ãµes
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="ad-native-bottom">
    <script async data-cfasync="false"
      src="https://pl28456427.effectivegatecpm.com/cccc7245f0c46289c4b3a2911da39bca/invoke.js"></script>
    <div id="container-cccc7245f0c46289c4b3a2911da39bca"></div>
  </div>

</main>

<!-- ================================================
     FOOTER
================================================ -->
<footer class="footer" role="contentinfo">
  <div class="footer-logo">PIPOCA<span>FLIX</span></div>
  <p class="footer-text">
    O melhor catÃ¡logo de filmes e sÃ©ries online. Assista quando quiser, onde quiser.
    Qualidade HD e experiÃªncia cinematogrÃ¡fica no seu dispositivo.
  </p>
  <div class="ad-footer">
    <script async data-cfasync="false"
      src="https://pl28456427.effectivegatecpm.com/cccc7245f0c46289c4b3a2911da39bca/invoke.js"></script>
    <div id="container-cccc7245f0c46289c4b3a2911da39bca-footer"></div>
  </div>
  <div class="footer-bottom">
    <span>Â© 2025 PipocaFlix. Todos os direitos reservados.</span>
    <span>Feito com â¤ï¸ para fÃ£s de cinema</span>
  </div>
</footer>

<!-- Toast -->
<div class="toast" id="toast" role="status" aria-live="polite"></div>

<!-- ================================================
     SCRIPTS
================================================ -->
<script src="../assets/js/security.js"></script>
<script src="../assets/js/api.js"></script>
<script src="../assets/js/search.js"></script>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//   PIPOCAFLIX v2 â€” index.js (inline)
//   Arquitetura: fetch Ãºnico + memÃ³ria separada + render lazy
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â”€â”€â”€ Estado global â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const STATE = {
  allFilmes:  [],
  allSeries:  [],
  allContent: [],

  // Recentes
  recentesPage: 0,
  recentesPerPage: 15,

  // Filmes catÃ¡logo completo
  filmesPage: 1,
  filmesPerPage: 15,
  filmesOpen: false,

  // SÃ©ries catÃ¡logo completo
  seriesPage: 1,
  seriesPerPage: 15,
  seriesOpen: false,

  // Hero rotaÃ§Ã£o
  heroIdx: 0,
  heroPool: [],
  heroTimer: null
};

// â”€â”€â”€ Utilidades â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function showToast(msg, ms = 2500) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), ms);
}

/** Fisher-Yates shuffle imutÃ¡vel */
function shuffled(arr) {
  const a = arr.slice();
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

// â”€â”€â”€ Render Card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderCard(item) {
  const div  = document.createElement('div');
  div.className = 'card';
  div.setAttribute('role', 'article');
  div.setAttribute('aria-label', item.nome);
  div.setAttribute('tabindex', '0');

  const page = item.isSerie ? 'serie.html' : 'filme.html';
  const href = `${page}?nome=${encodeURIComponent(item.nome)}`;

  div.innerHTML = `
    <img class="card-thumb"
      src="${item.capa || ''}"
      alt="${item.nome}"
      loading="lazy"
      onerror="this.src='https://placehold.co/300x450/181818/555?text=Sem+Capa'">
    <span class="card-type-badge">${item.isSerie ? 'SÃ©rie' : 'Filme'}</span>
    <div class="card-play-btn">
      <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
    </div>
    <div class="card-info">
      <div class="card-title">${item.nome}</div>
      <div class="card-meta">
        <span>${item.ano || ''}</span>
        ${item.categoria ? `<span>Â· ${item.categoria.split(',')[0].trim()}</span>` : ''}
      </div>
    </div>
  `;

  const go = () => { location.href = href; };
  div.addEventListener('click', go);
  div.addEventListener('keydown', e => { if (e.key === 'Enter' || e.key === ' ') go(); });
  return div;
}

/** Renderiza array de items em um grid usando DocumentFragment */
function fillGrid(gridEl, items) {
  const frag = document.createDocumentFragment();
  items.forEach(item => frag.appendChild(renderCard(item)));
  gridEl.innerHTML = '';
  gridEl.appendChild(frag);
}

// â”€â”€â”€ PaginaÃ§Ã£o genÃ©rica â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildPagination(containerId, total, perPage, current, onPageChange) {
  const container = document.getElementById(containerId);
  const pages = Math.ceil(total / perPage);
  container.innerHTML = '';
  if (pages <= 1) return;

  const mk = (label, page, disabled, active) => {
    const btn = document.createElement('button');
    btn.className = 'page-btn' + (active ? ' active' : '');
    btn.textContent = label;
    btn.disabled = disabled;
    if (active) btn.setAttribute('aria-current', 'page');
    btn.addEventListener('click', () => onPageChange(page));
    return btn;
  };

  container.appendChild(mk('â€¹', current - 1, current === 1, false));

  const info = document.createElement('span');
  info.className = 'page-info';
  info.textContent = `${current} / ${pages}`;
  container.appendChild(info);

  let s = Math.max(1, current - 2);
  let e = Math.min(pages, s + 4);
  s = Math.max(1, e - 4);

  if (s > 1) container.appendChild(mk('1', 1, false, false));
  if (s > 2) { const d = document.createElement('span'); d.className = 'page-info'; d.textContent = 'â€¦'; container.appendChild(d); }

  for (let i = s; i <= e; i++) container.appendChild(mk(i, i, false, i === current));

  if (e < pages - 1) { const d = document.createElement('span'); d.className = 'page-info'; d.textContent = 'â€¦'; container.appendChild(d); }
  if (e < pages) container.appendChild(mk(pages, pages, false, false));

  container.appendChild(mk('â€º', current + 1, current === pages, false));
}

// â”€â”€â”€ HERO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setupHero(items) {
  const pool = items.filter(c => c.capa).slice(0, 15);
  if (!pool.length) return;
  STATE.heroPool = shuffled(pool);

  function applyHero(it) {
    const bg = document.getElementById('heroBg');
    bg.style.backgroundImage = `url(${it.capa})`;
    document.getElementById('heroTitle').textContent = it.nome;
    document.getElementById('heroSynopsis').textContent = it.sinopse || '';
    document.getElementById('heroMeta').innerHTML = `
      ${it.ano      ? `<span>ğŸ“… ${it.ano}</span>`                                    : ''}
      ${it.duracao  ? `<span>â± ${it.duracao}</span>`                                : ''}
      ${it.categoria? `<span>ğŸ­ ${it.categoria.split(',')[0].trim()}</span>`         : ''}
      ${it.audio    ? `<span>ğŸ”Š ${it.audio}</span>`                                  : ''}
    `;
    const page = it.isSerie ? 'serie.html' : 'filme.html';
    document.getElementById('heroWatchBtn').href = `${page}?nome=${encodeURIComponent(it.nome)}`;
  }

  applyHero(STATE.heroPool[0]);

  if (STATE.heroPool.length > 1) {
    STATE.heroTimer = setInterval(() => {
      STATE.heroIdx = (STATE.heroIdx + 1) % STATE.heroPool.length;
      applyHero(STATE.heroPool[STATE.heroIdx]);
    }, 8000);
  }

  document.getElementById('heroInfoBtn').addEventListener('click', () => {
    const it = STATE.heroPool[STATE.heroIdx];
    const page = it.isSerie ? 'serie.html' : 'filme.html';
    location.href = `${page}?nome=${encodeURIComponent(it.nome)}`;
  });
}

// â”€â”€â”€ SEÃ‡ÃƒO: MAIS RECENTES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function initRecentes() {
  // "Mais recentes" = Ãºltimos adicionados = fim do array (sem embaralhar)
  const todos  = STATE.allContent;          // ordem original do Sheets = ordem de adiÃ§Ã£o
  const total  = todos.length;
  const perPg  = STATE.recentesPerPage;

  const skeleton = document.getElementById('recentesSkeleton');
  const grid     = document.getElementById('recentesGrid');
  const loadMore = document.getElementById('recentesLoadMore');
  const counter  = document.getElementById('recentesCount');

  // Mostra os primeiros 15
  STATE.recentesPage = 1;

  function renderPage() {
    const end   = STATE.recentesPage * perPg;
    const slice = todos.slice(0, end);

    skeleton.style.display = 'none';
    grid.style.display = 'grid';
    fillGrid(grid, slice);

    counter.textContent = `${Math.min(end, total)} de ${total} conteÃºdos`;

    if (end >= total) {
      loadMore.classList.add('hidden');
    } else {
      loadMore.classList.remove('hidden');
    }
  }

  renderPage();

  loadMore.addEventListener('click', () => {
    STATE.recentesPage++;
    renderPage();
    // Scroll suave para o Ãºltimo card novo
    grid.lastElementChild?.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
  });
}

// â”€â”€â”€ SEÃ‡ÃƒO: FILMES (preview + catÃ¡logo completo) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function initFilmesSection() {
  const skeleton  = document.getElementById('filmesSkeleton');
  const preview   = document.getElementById('filmesPreviewGrid');
  const catalogo  = document.getElementById('filmesCatalogo');
  const fullGrid  = document.getElementById('filmesFullGrid');
  const counter   = document.getElementById('filmesCount');
  const verTudoBtn= document.getElementById('filmesVerTudo');

  skeleton.style.display = 'none';
  preview.style.display  = 'grid';

  // Preview: 15 aleatÃ³rios
  const preview15 = shuffled(STATE.allFilmes).slice(0, 15);
  fillGrid(preview, preview15);

  // BotÃ£o "Ver catÃ¡logo completo"
  verTudoBtn.addEventListener('click', () => {
    STATE.filmesOpen = !STATE.filmesOpen;
    if (STATE.filmesOpen) {
      catalogo.classList.add('is-open');
      verTudoBtn.setAttribute('aria-expanded', 'true');
      verTudoBtn.querySelector('svg').style.transform = 'rotate(90deg)';
      STATE.filmesPage = 1;
      renderFilmesCatalogo();
      // Scroll atÃ© a seÃ§Ã£o
      setTimeout(() => {
        document.getElementById('filmes').scrollIntoView({ behavior: 'smooth', block: 'start' });
      }, 80);
    } else {
      catalogo.classList.remove('is-open');
      verTudoBtn.setAttribute('aria-expanded', 'false');
      verTudoBtn.querySelector('svg').style.transform = '';
    }
  });
}

function renderFilmesCatalogo() {
  const total   = STATE.allFilmes.length;
  const perPg   = STATE.filmesPerPage;
  const pg      = STATE.filmesPage;
  const start   = (pg - 1) * perPg;
  const slice   = STATE.allFilmes.slice(start, start + perPg);

  const fullGrid = document.getElementById('filmesFullGrid');
  const counter  = document.getElementById('filmesCount');

  fillGrid(fullGrid, slice);
  counter.textContent = `${total} filmes Â· pÃ¡gina ${pg} de ${Math.ceil(total / perPg)}`;

  buildPagination('filmesPagination', total, perPg, pg, (newPage) => {
    STATE.filmesPage = newPage;
    renderFilmesCatalogo();
    document.getElementById('filmesCatalogo').scrollIntoView({ behavior: 'smooth', block: 'start' });
  });
}

// â”€â”€â”€ SEÃ‡ÃƒO: SÃ‰RIES (preview + catÃ¡logo completo) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function initSeriesSection() {
  const skeleton  = document.getElementById('seriesSkeleton');
  const preview   = document.getElementById('seriesPreviewGrid');
  const catalogo  = document.getElementById('seriesCatalogo');
  const verTudoBtn= document.getElementById('seriesVerTudo');

  skeleton.style.display = 'none';
  preview.style.display  = 'grid';

  // Preview: 15 aleatÃ³rios
  const preview15 = shuffled(STATE.allSeries).slice(0, 15);
  fillGrid(preview, preview15);

  // BotÃ£o "Ver catÃ¡logo completo"
  verTudoBtn.addEventListener('click', () => {
    STATE.seriesOpen = !STATE.seriesOpen;
    if (STATE.seriesOpen) {
      catalogo.classList.add('is-open');
      verTudoBtn.setAttribute('aria-expanded', 'true');
      verTudoBtn.querySelector('svg').style.transform = 'rotate(90deg)';
      STATE.seriesPage = 1;
      renderSeriesCatalogo();
      setTimeout(() => {
        document.getElementById('series').scrollIntoView({ behavior: 'smooth', block: 'start' });
      }, 80);
    } else {
      catalogo.classList.remove('is-open');
      verTudoBtn.setAttribute('aria-expanded', 'false');
      verTudoBtn.querySelector('svg').style.transform = '';
    }
  });
}

function renderSeriesCatalogo() {
  const total   = STATE.allSeries.length;
  const perPg   = STATE.seriesPerPage;
  const pg      = STATE.seriesPage;
  const start   = (pg - 1) * perPg;
  const slice   = STATE.allSeries.slice(start, start + perPg);

  const fullGrid = document.getElementById('seriesFullGrid');
  const counter  = document.getElementById('seriesCount');

  fillGrid(fullGrid, slice);
  counter.textContent = `${total} sÃ©ries Â· pÃ¡gina ${pg} de ${Math.ceil(total / perPg)}`;

  buildPagination('seriesPagination', total, perPg, pg, (newPage) => {
    STATE.seriesPage = newPage;
    renderSeriesCatalogo();
    document.getElementById('seriesCatalogo').scrollIntoView({ behavior: 'smooth', block: 'start' });
  });
}

// â”€â”€â”€ BUSCA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setupSearch() {
  const desktopInput   = document.getElementById('desktopSearchInput');
  const mobileInput    = document.getElementById('mobileSearchInput');
  const resultsOverlay = document.getElementById('searchResultsOverlay');
  const resultsGrid    = document.getElementById('searchResultsGrid');
  const noResults      = document.getElementById('noResults');
  const queryLabel     = document.getElementById('searchQueryLabel');
  const mobileToggle   = document.getElementById('mobileSearchToggle');
  const mobileOverlay  = document.getElementById('mobileSearchOverlay');
  const mobileClose    = document.getElementById('mobileSearchClose');

  function doSearch(query) {
    if (!query || query.trim().length < 2) {
      resultsOverlay.classList.remove('active');
      return;
    }
    const results = PipocaSearch.search(query, 24);
    queryLabel.textContent  = `"${query}"`;
    noResults.style.display = results.length === 0 ? 'block' : 'none';
    const frag = document.createDocumentFragment();
    results.forEach(item => frag.appendChild(renderCard(item)));
    resultsGrid.innerHTML = '';
    resultsGrid.appendChild(frag);
    resultsOverlay.classList.add('active');
  }

  const debouncedSearch = PipocaSearch.debounce(doSearch, 280);

  desktopInput.addEventListener('input', e => debouncedSearch(e.target.value));
  mobileInput.addEventListener('input',  e => debouncedSearch(e.target.value));

  document.addEventListener('keydown', e => {
    if (e.key === 'Escape') {
      resultsOverlay.classList.remove('active');
      desktopInput.value = '';
      mobileInput.value  = '';
      mobileOverlay.classList.remove('open');
      mobileToggle.setAttribute('aria-expanded', 'false');
    }
  });

  mobileToggle.addEventListener('click', () => {
    mobileOverlay.classList.add('open');
    mobileToggle.setAttribute('aria-expanded', 'true');
    setTimeout(() => mobileInput.focus(), 100);
  });

  mobileClose.addEventListener('click', () => {
    mobileOverlay.classList.remove('open');
    mobileToggle.setAttribute('aria-expanded', 'false');
    resultsOverlay.classList.remove('active');
    mobileInput.value = '';
  });

  resultsOverlay.addEventListener('click', e => {
    if (e.target === resultsOverlay) {
      resultsOverlay.classList.remove('active');
      desktopInput.value = '';
      mobileInput.value  = '';
    }
  });
}

// â”€â”€â”€ HEADER SCROLL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.addEventListener('scroll', () => {
  document.getElementById('mainHeader').classList.toggle('scrolled', window.scrollY > 50);
}, { passive: true });

// â”€â”€â”€ Intersection Observer para seÃ§Ãµes lazy â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function observeSection(sectionId, callback) {
  const el = document.getElementById(sectionId);
  if (!el) return;
  const obs = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        callback();
        obs.unobserve(entry.target);
      }
    });
  }, { threshold: 0.05, rootMargin: '200px 0px' });
  obs.observe(el);
}

// â”€â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function init() {
  try {
    // Fetch Ãºnico em paralelo â€” apenas uma chamada por tipo
    const [filmes, series] = await Promise.all([
      PipocaAPI.getFilmes(),
      PipocaAPI.getSeries()
    ]);

    // Popula estado global
    STATE.allFilmes  = filmes;
    STATE.allSeries  = series;
    // allContent: merge com series por Ãºltimo (assim recentes mostram o fim = Ãºltimos adicionados)
    STATE.allContent = [...filmes, ...series];

    // Indexa busca
    PipocaSearch.indexContent(STATE.allContent);

    // Hero com pool misto
    setupHero(STATE.allContent);

    // Busca
    setupSearch();

    // Mais Recentes â€” renderiza imediatamente (acima da dobra)
    initRecentes();

    // Filmes + SÃ©ries â€” Intersection Observer (sÃ³ renderiza quando entra na tela)
    observeSection('filmes', initFilmesSection);
    observeSection('series', initSeriesSection);

  } catch (err) {
    console.error('[PipocaFlix] Erro ao carregar:', err);
    // Esconde skeletons e mostra erro
    ['recentesSkeleton','filmesSkeleton','seriesSkeleton'].forEach(id => {
      const el = document.getElementById(id);
      if (el) el.innerHTML = '<p style="grid-column:1/-1;color:var(--text-muted);text-align:center;padding:2rem 0">âš ï¸ Erro ao carregar conteÃºdo. Tente novamente.</p>';
    });
  }
}

document.addEventListener('DOMContentLoaded', init);
</script>

</body>
</html>
