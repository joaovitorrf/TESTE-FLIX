<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PipocaFlix ‚Äî Filmes e S√©ries Online</title>
<meta name="description" content="Assista filmes e s√©ries online gr√°tis no PipocaFlix. Cat√°logo completo em HD.">
<meta name="theme-color" content="#ff2d43">
<link rel="stylesheet" href="../assets/css/style.css">

<!-- Social Bar -->
<script src="https://pl28456424.effectivegatecpm.com/af/b2/ae/afb2aeef36a1a40f4d3634823ebf0f59.js"></script>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê MOBILE SEARCH OVERLAY ‚ïê‚ïê‚ïê -->
<div class="mobile-search-overlay" id="mobileSearchOverlay" role="dialog" aria-label="Busca">
  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="flex-shrink:0;color:var(--red)">
    <circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/>
  </svg>
  <input type="search" class="mobile-search-input" id="mobileSearchInput"
    placeholder="Buscar filmes e s√©ries..." autocomplete="off" spellcheck="false">
  <button class="mobile-search-cancel" id="mobileSearchClose">Cancelar</button>
</div>

<!-- ‚ïê‚ïê‚ïê HEADER ‚ïê‚ïê‚ïê -->
<header class="header" id="mainHeader">
  <a href="index.html" class="logo" aria-label="PipocaFlix Home">PipocaFlix</a>
  <nav class="nav" aria-label="Navega√ß√£o">
    <a href="index.html" class="active">In√≠cio</a>
    <a href="catalogo.html">Cat√°logo</a>
    <a href="catalogo.html?tipo=filmes">Filmes</a>
    <a href="catalogo.html?tipo=series">S√©ries</a>
  </nav>
  <div class="search-wrapper">
    <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/>
    </svg>
    <input type="search" class="search-bar" id="desktopSearchInput"
      placeholder="Buscar filmes e s√©ries..." autocomplete="off" spellcheck="false" aria-label="Buscar">
  </div>
  <button class="search-toggle-btn" id="mobileSearchToggle" aria-label="Abrir busca" aria-expanded="false">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
      <circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/>
    </svg>
  </button>
</header>

<!-- ‚ïê‚ïê‚ïê SEARCH RESULTS ‚ïê‚ïê‚ïê -->
<div class="search-results-overlay" id="searchResultsOverlay" role="region" aria-label="Resultados">
  <p class="search-results-label">Resultados para: <strong id="searchQueryLabel"></strong></p>
  <div class="cards-grid" id="searchResultsGrid"></div>
  <p id="searchNoResults" style="display:none;color:var(--text-3);text-align:center;padding:3rem 0">
    Nenhum resultado encontrado. Tente outra busca.
  </p>
</div>

<!-- ‚ïê‚ïê‚ïê HERO CARROSSEL ‚ïê‚ïê‚ïê -->
<section class="hero" id="hero" aria-label="Destaques">
  <div class="hero-slides" id="heroSlides">
    <!-- Slides injetados por JS -->
    <div class="hero-slide active">
      <div class="hero-slide-bg" style="background:linear-gradient(135deg,#0c0c10,#1a1a24)"></div>
    </div>
  </div>

  <!-- Content para cada slide (√∫nico, atualizado por JS) -->
  <div class="hero-content" id="heroContent" aria-live="polite">
    <div class="hero-badge">üî• Em Destaque</div>
    <h1 class="hero-title" id="heroTitle">Carregando...</h1>
    <div class="hero-meta" id="heroMeta"></div>
    <p class="hero-synopsis" id="heroSynopsis"></p>
    <div class="hero-btns">
      <a href="#" id="heroWatchBtn" class="btn-primary">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>
        Assistir Agora
      </a>
      <a href="#" id="heroInfoBtn" class="btn-secondary">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg>
        Mais Infos
      </a>
    </div>
  </div>

  <!-- Navega√ß√£o do hero -->
  <div class="hero-arrows" role="group" aria-label="Navegar destaques">
    <button class="hero-arrow" id="heroPrev" aria-label="Anterior">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M15 18l-6-6 6-6"/></svg>
    </button>
    <button class="hero-arrow" id="heroNext" aria-label="Pr√≥ximo">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M9 18l6-6-6-6"/></svg>
    </button>
  </div>
  <div class="hero-dots" id="heroDots" role="tablist"></div>
</section>

<!-- ‚ïê‚ïê‚ïê AD 468x60 ‚ïê‚ïê‚ïê -->
<div class="ad-section" style="padding-top:1.5rem;padding-bottom:0">
  <div class="ad-wrap ad-468x60">
    <script>
      atOptions = { 'key':'c7b645a0a4ac7dc79a9417f5852ebe16','format':'iframe','height':60,'width':468,'params':{} };
    </script>
    <script src="https://www.highperformanceformat.com/c7b645a0a4ac7dc79a9417f5852ebe16/invoke.js"></script>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê CATEGORIAS ‚ïê‚ïê‚ïê -->
<section class="categories-section">
  <div class="section-header">
    <h2 class="section-title">Explorar Categorias</h2>
  </div>
  <div class="cat-scroll-wrap">
    <div class="cat-scroll" id="catScroll"></div>
  </div>
</section>

<!-- ‚ïê‚ïê‚ïê FILMES RECENTES ‚ïê‚ïê‚ïê -->
<section class="content-section">
  <div class="section-header">
    <h2 class="section-title">Filmes Recentes</h2>
    <a href="catalogo.html?tipo=filmes" class="see-all-link">
      Ver todos
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M9 18l6-6-6-6"/></svg>
    </a>
  </div>
  <div class="carousel-wrap">
    <button class="carousel-arrow prev" id="filmePrev" aria-label="Anterior">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M15 18l-6-6 6-6"/></svg>
    </button>
    <!-- Skeleton -->
    <div class="carousel-track" id="filmesTrack" aria-label="Filmes recentes">
      <div class="skeleton" style="width:160px;flex-shrink:0"></div>
      <div class="skeleton" style="width:160px;flex-shrink:0"></div>
      <div class="skeleton" style="width:160px;flex-shrink:0"></div>
      <div class="skeleton" style="width:160px;flex-shrink:0"></div>
      <div class="skeleton" style="width:160px;flex-shrink:0"></div>
    </div>
    <button class="carousel-arrow next" id="filmeNext" aria-label="Pr√≥ximo">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M9 18l6-6-6-6"/></svg>
    </button>
  </div>
</section>

<!-- ‚ïê‚ïê‚ïê AD 300x250 entre se√ß√µes ‚ïê‚ïê‚ïê -->
<div class="ad-section">
  <div class="ad-wrap ad-300x250">
    <script>
      atOptions = { 'key':'cc3696d612a9f3e92f49193e4b3418e6','format':'iframe','height':250,'width':300,'params':{} };
    </script>
    <script src="https://www.highperformanceformat.com/cc3696d612a9f3e92f49193e4b3418e6/invoke.js"></script>
  </div>
  <!-- Native Banner -->
  <div style="flex:1;max-width:468px">
    <script async data-cfasync="false"
      src="https://pl28456427.effectivegatecpm.com/cccc7245f0c46289c4b3a2911da39bca/invoke.js"></script>
    <div id="container-cccc7245f0c46289c4b3a2911da39bca"></div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê S√âRIES RECENTES ‚ïê‚ïê‚ïê -->
<section class="content-section">
  <div class="section-header">
    <h2 class="section-title">S√©ries em Destaque</h2>
    <a href="catalogo.html?tipo=series" class="see-all-link">
      Ver todas
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M9 18l6-6-6-6"/></svg>
    </a>
  </div>
  <div class="carousel-wrap">
    <button class="carousel-arrow prev" id="seriePrev" aria-label="Anterior">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M15 18l-6-6 6-6"/></svg>
    </button>
    <div class="carousel-track" id="seriesTrack" aria-label="S√©ries em destaque">
      <div class="skeleton" style="width:160px;flex-shrink:0"></div>
      <div class="skeleton" style="width:160px;flex-shrink:0"></div>
      <div class="skeleton" style="width:160px;flex-shrink:0"></div>
      <div class="skeleton" style="width:160px;flex-shrink:0"></div>
      <div class="skeleton" style="width:160px;flex-shrink:0"></div>
    </div>
    <button class="carousel-arrow next" id="serieNext" aria-label="Pr√≥ximo">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M9 18l6-6-6-6"/></svg>
    </button>
  </div>
</section>

<!-- ‚ïê‚ïê‚ïê AD 468x60 antes do footer ‚ïê‚ïê‚ïê -->
<div class="ad-section">
  <div class="ad-wrap ad-468x60">
    <script>
      atOptions = { 'key':'c7b645a0a4ac7dc79a9417f5852ebe16','format':'iframe','height':60,'width':468,'params':{} };
    </script>
    <script src="https://www.highperformanceformat.com/c7b645a0a4ac7dc79a9417f5852ebe16/invoke.js"></script>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê FOOTER ‚ïê‚ïê‚ïê -->
<footer class="footer">
  <div class="footer-logo">PipocaFlix</div>
  <p class="footer-desc">O melhor cat√°logo de filmes e s√©ries online. Assista quando quiser, onde quiser ‚Äî experi√™ncia cinematogr√°fica no seu dispositivo.</p>
  <div class="ad-section" style="padding:0 0 1.5rem">
    <script async data-cfasync="false"
      src="https://pl28456427.effectivegatecpm.com/cccc7245f0c46289c4b3a2911da39bca/invoke.js"></script>
    <div id="container-cccc7245f0c46289c4b3a2911da39bca-footer"></div>
  </div>
  <div class="footer-bottom">
    <span>¬© 2025 PipocaFlix. Todos os direitos reservados.</span>
    <span style="color:var(--red)">Feito com ‚ù§Ô∏è para f√£s de cinema</span>
  </div>
</footer>

<!-- Back to top -->
<button class="back-to-top" id="backToTop" aria-label="Voltar ao topo">
  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M18 15l-6-6-6 6"/></svg>
</button>

<div class="toast" id="toast" role="status" aria-live="polite"></div>

<!-- ‚ïê‚ïê‚ïê SCRIPTS ‚ïê‚ïê‚ïê -->
<script src="../assets/js/security.js"></script>
<script src="../assets/js/api.js"></script>
<script src="../assets/js/search.js"></script>
<script>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   PIPOCAFLIX INDEX.JS
   - Hero aleat√≥rio com carrossel autom√°tico
   - Carross√©is de filmes e s√©ries (horizontal)
   - Categorias din√¢micas
   - Busca com overlay
   - Sem pagina√ß√£o na home (ver cat√°logo vai pra outra p√°gina)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

// ‚îÄ‚îÄ Categorias com emojis e gradientes ‚îÄ‚îÄ
const CAT_CONFIG = {
  'a√ß√£o':       { emoji:'‚ö°', gradient:'linear-gradient(135deg,#1a1a2e,#e94560)' },
  'acao':       { emoji:'‚ö°', gradient:'linear-gradient(135deg,#1a1a2e,#e94560)' },
  'romance':    { emoji:'üíï', gradient:'linear-gradient(135deg,#2d1b1b,#c94b4b)' },
  'terror':     { emoji:'üëª', gradient:'linear-gradient(135deg,#0d0d0d,#3a1c71)' },
  'horror':     { emoji:'ü©∏', gradient:'linear-gradient(135deg,#0d0d0d,#3a1c71)' },
  'com√©dia':    { emoji:'üòÇ', gradient:'linear-gradient(135deg,#1a2a1a,#f7971e)' },
  'comedia':    { emoji:'üòÇ', gradient:'linear-gradient(135deg,#1a2a1a,#f7971e)' },
  'drama':      { emoji:'üé≠', gradient:'linear-gradient(135deg,#1a1a2e,#4a4a8a)' },
  'fic√ß√£o':     { emoji:'üöÄ', gradient:'linear-gradient(135deg,#001a33,#0077b6)' },
  'ficcao':     { emoji:'üöÄ', gradient:'linear-gradient(135deg,#001a33,#0077b6)' },
  'anima√ß√£o':   { emoji:'‚ú®', gradient:'linear-gradient(135deg,#1a0a2e,#7b2d8b)' },
  'animacao':   { emoji:'‚ú®', gradient:'linear-gradient(135deg,#1a0a2e,#7b2d8b)' },
  'aventura':   { emoji:'üó∫Ô∏è', gradient:'linear-gradient(135deg,#1a2010,#56ab2f)' },
  'thriller':   { emoji:'üî™', gradient:'linear-gradient(135deg,#0d0d10,#434343)' },
  'crime':      { emoji:'üî´', gradient:'linear-gradient(135deg,#0d0d10,#434343)' },
  'fantasia':   { emoji:'üßô', gradient:'linear-gradient(135deg,#1a0a30,#8360c3)' },
  'document√°rio':{ emoji:'üìΩÔ∏è', gradient:'linear-gradient(135deg,#101820,#2c5364)' },
  'documentario':{ emoji:'üìΩÔ∏è', gradient:'linear-gradient(135deg,#101820,#2c5364)' },
  'faroeste':   { emoji:'ü§†', gradient:'linear-gradient(135deg,#1a1005,#c79200)' },
  'guerra':     { emoji:'‚öîÔ∏è', gradient:'linear-gradient(135deg,#0d0d0d,#5c5c5c)' },
  'musical':    { emoji:'üéµ', gradient:'linear-gradient(135deg,#0d0020,#8b0000)' },
  'fam√≠lia':    { emoji:'üë®‚Äçüë©‚Äçüëß', gradient:'linear-gradient(135deg,#001a20,#00b4db)' },
  'familia':    { emoji:'üë®‚Äçüë©‚Äçüëß', gradient:'linear-gradient(135deg,#001a20,#00b4db)' },
};
function getCatConfig(cat) {
  const k = cat.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'');
  for (const key of Object.keys(CAT_CONFIG)) {
    if (k.includes(key) || key.includes(k)) return CAT_CONFIG[key];
  }
  return { emoji:'üé¨', gradient:'linear-gradient(135deg,#1a1a24,#ff2d43)' };
}

// ‚îÄ‚îÄ Helpers ‚îÄ‚îÄ
function norm(s) {
  return (s||'').toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'').replace(/[^a-z0-9\s]/g,' ').trim();
}
function showToast(msg, ms=2500) {
  const t = document.getElementById('toast');
  t.textContent = msg; t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), ms);
}

// ‚îÄ‚îÄ Header scroll ‚îÄ‚îÄ
const header = document.getElementById('mainHeader');
window.addEventListener('scroll', () => {
  header.classList.toggle('scrolled', window.scrollY > 60);
  document.getElementById('backToTop').classList.toggle('visible', window.scrollY > 400);
}, {passive:true});
document.getElementById('backToTop').addEventListener('click', () => window.scrollTo({top:0,behavior:'smooth'}));

// ‚îÄ‚îÄ Mobile search ‚îÄ‚îÄ
const mobileOverlay = document.getElementById('mobileSearchOverlay');
const mobileInput   = document.getElementById('mobileSearchInput');
document.getElementById('mobileSearchToggle').addEventListener('click', () => {
  mobileOverlay.classList.add('open');
  document.getElementById('mobileSearchToggle').setAttribute('aria-expanded','true');
  setTimeout(() => mobileInput.focus(), 80);
});
document.getElementById('mobileSearchClose').addEventListener('click', () => {
  mobileOverlay.classList.remove('open');
  document.getElementById('searchResultsOverlay').classList.remove('active');
  mobileInput.value = '';
});
document.addEventListener('keydown', e => {
  if (e.key === 'Escape') {
    mobileOverlay.classList.remove('open');
    document.getElementById('searchResultsOverlay').classList.remove('active');
    document.getElementById('desktopSearchInput').value = '';
    mobileInput.value = '';
  }
});

// ‚îÄ‚îÄ Render card (carrossel) ‚îÄ‚îÄ
function mkCard(item) {
  const div = document.createElement('div');
  div.className = 'card';
  const page = item.isSerie ? 'serie.html' : 'filme.html';
  div.innerHTML = `
    <div class="card-thumb-wrap">
      <img class="card-thumb" src="${item.capa||''}" alt="${item.nome}" loading="lazy"
        onerror="this.src='https://placehold.co/300x450/13131a/333?text=Sem+Capa'">
      <span class="card-badge">${item.isSerie?'S√©rie':'Filme'}</span>
      <div class="card-play">
        <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
      </div>
    </div>
    <div class="card-info">
      <div class="card-name">${item.nome}</div>
      <div class="card-meta-row">
        ${item.ano ? `<span>${item.ano}</span>`:''}
        ${item.categoria ? `<span>¬∑ ${item.categoria.split(',')[0].trim()}</span>`:''}
      </div>
    </div>`;
  div.addEventListener('click', () => { location.href = `${page}?nome=${encodeURIComponent(item.nome)}`; });
  div.setAttribute('role','button'); div.setAttribute('tabindex','0');
  div.addEventListener('keydown', e => { if (e.key==='Enter'||e.key===' ') div.click(); });
  return div;
}

// ‚îÄ‚îÄ Carousel scroll helpers ‚îÄ‚îÄ
function setupCarouselArrows(trackId, prevId, nextId) {
  const track = document.getElementById(trackId);
  const prev  = document.getElementById(prevId);
  const next  = document.getElementById(nextId);
  if (!track||!prev||!next) return;
  const STEP = 680;
  prev.addEventListener('click', () => track.scrollBy({left:-STEP,behavior:'smooth'}));
  next.addEventListener('click', () => track.scrollBy({left:STEP,behavior:'smooth'}));
}

// ‚îÄ‚îÄ Hero carrossel ‚îÄ‚îÄ
let heroItems = [];
let heroIdx   = 0;
let heroTimer = null;

function heroGoTo(idx) {
  heroIdx = (idx + heroItems.length) % heroItems.length;
  const item = heroItems[heroIdx];
  const page = item.isSerie ? 'serie.html' : 'filme.html';

  // BG
  document.getElementById('heroSlides').querySelectorAll('.hero-slide').forEach((s,i) => {
    s.classList.toggle('active', i === heroIdx);
    const bg = s.querySelector('.hero-slide-bg');
    if (bg) bg.style.backgroundImage = `url(${item.capa||''})`;
  });

  // Content
  document.getElementById('heroTitle').textContent = item.nome || '';
  document.getElementById('heroSynopsis').textContent = item.sinopse || '';
  document.getElementById('heroMeta').innerHTML = [
    item.ano      ? `<span class="hero-meta-tag">üìÖ ${item.ano}</span>` : '',
    item.duracao  ? `<span class="hero-meta-tag">‚è± ${item.duracao}</span>` : '',
    item.categoria? `<span class="hero-meta-tag">üé≠ ${item.categoria.split(',')[0].trim()}</span>` : '',
    item.audio    ? `<span class="hero-meta-tag">üîä ${item.audio}</span>` : '',
  ].join('');
  document.getElementById('heroWatchBtn').href = `${page}?nome=${encodeURIComponent(item.nome)}`;
  document.getElementById('heroInfoBtn').href  = `${page}?nome=${encodeURIComponent(item.nome)}`;

  // Dots
  document.querySelectorAll('.hero-dot').forEach((d,i) => d.classList.toggle('active', i===heroIdx));
}

function heroStart() {
  clearInterval(heroTimer);
  heroTimer = setInterval(() => heroGoTo(heroIdx + 1), 7000);
}

function setupHero(allContent) {
  // Pega at√© 10 itens COM capa, embaralhados
  const pool = allContent.filter(c => c.capa && c.sinopse)
    .sort(() => Math.random() - 0.5)
    .slice(0, 10);

  heroItems = pool.length > 0 ? pool : allContent.filter(c=>c.capa).slice(0,5);
  if (heroItems.length === 0) return;

  // Cria slides
  const slidesEl = document.getElementById('heroSlides');
  slidesEl.innerHTML = '';
  heroItems.forEach((item, i) => {
    const slide = document.createElement('div');
    slide.className = 'hero-slide' + (i===0?' active':'');
    slide.innerHTML = `<div class="hero-slide-bg" style="background-image:url('${item.capa||''}')"></div>`;
    slidesEl.appendChild(slide);
  });

  // Dots
  const dotsEl = document.getElementById('heroDots');
  dotsEl.innerHTML = '';
  heroItems.forEach((_, i) => {
    const dot = document.createElement('button');
    dot.className = 'hero-dot' + (i===0?' active':'');
    dot.setAttribute('role','tab');
    dot.setAttribute('aria-label', `Slide ${i+1}`);
    dot.addEventListener('click', () => { heroGoTo(i); heroStart(); });
    dotsEl.appendChild(dot);
  });

  // Arrows
  document.getElementById('heroPrev').addEventListener('click', () => { heroGoTo(heroIdx-1); heroStart(); });
  document.getElementById('heroNext').addEventListener('click', () => { heroGoTo(heroIdx+1); heroStart(); });

  heroGoTo(0);
  heroStart();
}

// ‚îÄ‚îÄ Categorias ‚îÄ‚îÄ
function setupCategories(allContent) {
  const catMap = {};
  allContent.forEach(item => {
    if (!item.categoria) return;
    item.categoria.split(',').forEach(c => {
      const k = c.trim();
      if (!k) return;
      if (!catMap[k]) catMap[k] = 0;
      catMap[k]++;
    });
  });

  const cats = Object.entries(catMap)
    .sort((a,b) => b[1]-a[1])
    .slice(0, 16);

  const scroll = document.getElementById('catScroll');
  scroll.innerHTML = '';
  cats.forEach(([cat, count]) => {
    const cfg = getCatConfig(cat);
    const div = document.createElement('div');
    div.className = 'cat-card';
    div.innerHTML = `
      <div class="cat-card-bg" style="background:${cfg.gradient}">${cfg.emoji}</div>
      <div class="cat-card-overlay">
        <div class="cat-card-name">${cat}</div>
        <div class="cat-card-count">${count} t√≠tulos</div>
      </div>`;
    div.setAttribute('role','button');
    div.setAttribute('tabindex','0');
    div.setAttribute('aria-label',`Ver categoria ${cat}`);
    div.addEventListener('click', () => {
      location.href = `catalogo.html?cat=${encodeURIComponent(cat)}`;
    });
    div.addEventListener('keydown', e => { if(e.key==='Enter'||e.key===' ') div.click(); });
    scroll.appendChild(div);
  });
}

// ‚îÄ‚îÄ Render carousel track ‚îÄ‚îÄ
function fillTrack(trackId, items, max=20) {
  const track = document.getElementById(trackId);
  track.innerHTML = '';
  items.slice(0, max).forEach(item => track.appendChild(mkCard(item)));
}

// ‚îÄ‚îÄ Search ‚îÄ‚îÄ
function setupSearch(allContent) {
  PipocaSearch.indexContent(allContent);

  const resultsOverlay = document.getElementById('searchResultsOverlay');
  const resultsGrid    = document.getElementById('searchResultsGrid');
  const queryLabel     = document.getElementById('searchQueryLabel');
  const noResults      = document.getElementById('searchNoResults');

  function doSearch(q) {
    if (!q || q.trim().length < 2) {
      resultsOverlay.classList.remove('active');
      return;
    }
    const res = PipocaSearch.search(q, 30);
    queryLabel.textContent = q;
    resultsGrid.innerHTML  = '';
    noResults.style.display = res.length === 0 ? 'block' : 'none';
    res.forEach(item => resultsGrid.appendChild(mkCard(item)));
    resultsOverlay.classList.add('active');
  }

  const deb = PipocaSearch.debounce(doSearch, 250);
  document.getElementById('desktopSearchInput').addEventListener('input', e => deb(e.target.value));
  mobileInput.addEventListener('input', e => deb(e.target.value));
  resultsOverlay.addEventListener('click', e => {
    if (e.target === resultsOverlay) {
      resultsOverlay.classList.remove('active');
      document.getElementById('desktopSearchInput').value = '';
      mobileInput.value = '';
    }
  });
}

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ
async function init() {
  try {
    const [filmes, series] = await Promise.all([
      PipocaAPI.getFilmes(),
      PipocaAPI.getSeries()
    ]);
    const allContent = [...filmes, ...series];

    // Hero aleat√≥rio
    setupHero(allContent);

    // Categorias
    setupCategories(allContent);

    // Filmes carrossel (embaralhado para variar)
    const filmesShuffled = [...filmes].sort(() => Math.random() - 0.5);
    fillTrack('filmesTrack', filmesShuffled, 24);
    setupCarouselArrows('filmesTrack','filmePrev','filmeNext');

    // S√©ries carrossel
    const seriesShuffled = [...series].sort(() => Math.random() - 0.5);
    fillTrack('seriesTrack', seriesShuffled, 24);
    setupCarouselArrows('seriesTrack','seriePrev','serieNext');

    // Search
    setupSearch(allContent);

  } catch(err) {
    console.error('[PipocaFlix]', err);
    showToast('‚ö†Ô∏è Erro ao carregar conte√∫do. Verifique sua conex√£o.');
  }
}

document.addEventListener('DOMContentLoaded', init);
</script>

</body>
</html>
